---
title: "Project 3"
author: "Jeffrey Zhang and Jaclyn Nguyen"
date: "Monday, February 16, 2015"
output: html_document
---

Project 3 required Jeffrey and I to import a large dataset into Oracle Server and call the data into RStudio for analysis. Below will describe the dataset and the following analysis. 

Dataset: GOVSPENDING2007, GOVSPENDING2007, GOVSPENDING2008, CENSUSCOUNTY

Oracle SQL Developer: C##CS329E_JCN565
___

__1. Loading of R packages: RCurl, ggplot2, extrafont, jsonlite, dplyr, tidyr (R code not shown)__

```{r, include=FALSE}
library(RCurl)
library (ggplot2)
library(extrafont)
library(reshape2)
require("jsonlite")
require(dplyr)
require(tidyr)
```

__2. Import dataset from Oracle server__
```{r}
source("../01 data/df_06.R",echo = T)
tbl_df(df_06)
source("../01 data/df_07.R",echo = T)
tbl_df(df_07)
source("../01 data/dfcensus.R",echo = T)
tbl_df(dfpop)
```
__3. begin analysis__
First we want to know how many federal funds that each city has. A city could receive the federal funds many times a year and there are also some blank entries (no city names). I did these data wrangling in the following: 

__First I plotted the original dataset for df_06__
```{r}
source("../03 Visualization/plot1.R",echo = T)
```

__I filtered the blank entries for both df_06 and df_07__

```{r}
source("../02 Data Wrangling/DR1.R",echo = T)
source("../02 Data Wrangling/DR2.R",echo = T)
```

__I sum the totol funds for each city for both df_06 and df_07__
```{r}
source("../02 Data Wrangling/DR3.R",echo = T)
source("../02 Data Wrangling/DR4.R",echo = T)
```

__First I used left_join to join df_07_city_total_fund with df_06_city_total_fund. I found that there are many unmatched records in df_06_city_total_fund. So at this point, I am only intertested in the range and quatiles of 2007 city funding without comparing to 2006 city funding. Therefore I made an boxplot for that. From the graph, we can see that there are too many outliers in df_07_city_total_fund. The range is pretty big and the distribution is extremely skewed to the right__

```{r}
source("../02 Data Wrangling/DR5.R",echo = T)
source("../03 Visualization/plot2.R",echo = T)
```

__Now I inner join two datasets by city to make more sense__
```{r}
source("../02 Data Wrangling/DR6.R",echo = T)
```

__Use a beautiful bubble plot to visualize the gragh. First plot bubble plot: fed_fund_06 VS CitiesFrom the bubble graph, we can easily to see the difference of federal fund amount between these cities by the bubble size__
```{r}
source("../03 Visualization/plot3.R",echo = T)
```

__Same for 2007__
```{r}
source("../03 Visualization/plot4.R",echo = T)
```

__Now I will make a boxplot to see the range and quatiles of 2006 fund and 2007 fund. First I did data wrangling__
```{r}
source("../02 Data Wrangling/DR7.R",echo = T)
```

__Plot the boxplot. Since there are many big outliers in 2006 and 2007 as we can see, the "box"" is compressed to be very "narrow" (almost a line as we can see). But we can see the median or fifty percentile in 2007 is a little bigger than that in 2006. Moreover, the total_fund of 2006 is more concentrated than that of 2007__
```{r}
source("../03 Visualization/plot5.R",echo = T)
```


```{r}
names(dfpop) <- c('PRINCIPAL_PLACE_STATE','RECIPIENT_COUNTY_NAME','POPULATION')
df_state <- dfpop %>% select (PRINCIPAL_PLACE_STATE, POPULATION) %>% group_by(PRINCIPAL_PLACE_STATE) %>% summarise(sum(POPULATION))
df_state06 <- df_06 %>% select (PRINCIPAL_PLACE_STATE, FED_FUNDING_AMOUNT_06) %>% group_by(PRINCIPAL_PLACE_STATE) %>% summarise(sum(FED_FUNDING_AMOUNT_06))
df_state07 <- df_07 %>% select (PRINCIPAL_PLACE_STATE, FED_FUNDING_AMOUNT_07) %>% group_by(PRINCIPAL_PLACE_STATE) %>% summarise(sum(FED_FUNDING_AMOUNT_07))

dfsamestate <- inner_join(df_state06,df_state07,by = 'PRINCIPAL_PLACE_STATE')
mdf <- melt(dfsamestate, id.vars = 'PRINCIPAL_PLACE_STATE', measure.vars = c('sum(FED_FUNDING_AMOUNT_06)', 'sum(FED_FUNDING_AMOUNT_07)')) %>% ggplot(aes(x = PRINCIPAL_PLACE_STATE, y = value, color = variable)) + geom_point()



dffull <- full_join(df_state06,df_state07, by = 'PRINCIPAL_PLACE_STATE')
names(dffull) <- c('PRINCIPAL_PLACE_STATE','FED_FUNDING_AMOUNT_06','FED_FUNDING_AMOUNT_07')

dfsum <- dffull %>% select(FED_FUNDING_AMOUNT_06, FED_FUNDING_AMOUNT_07)  %>% summarise(T_FED_FUNDING_AMOUNT_06=cumsum(FED_FUNDING_AMOUNT_06), T_FED_FUNDING_AMOUNT_07 = cumsum(FED_FUNDING_AMOUNT_07))

dffull2 <- inner_join(dffull, df_state, by = 'PRINCIPAL_PLACE_STATE')
names(dffull2) <- c('PRINCIPAL_PLACE_STATE','FED_FUNDING_AMOUNT_06','FED_FUNDING_AMOUNT_07', 'POPULATION')
dffull3 <- dffull2 %>% mutate(perperson06 = FED_FUNDING_AMOUNT_06/POPULATION, perperson07 = FED_FUNDING_AMOUNT_07/POPULATION)
mdf2 <- melt(dffull3, id.vars = 'PRINCIPAL_PLACE_STATE', measure.vars= c('perperson06','perperson07'))
ggplot(mdf2,aes(x = PRINCIPAL_PLACE_STATE, y = value, color = variable)) + geom_point()  + theme(axis.text.x=element_text(angle=90, size=12, vjust=0.5)) + labs(title="Governmental Funding Broken Down\nPer Person",y="Total Funding per Person",x="State")
```


